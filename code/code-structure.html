<!DOCTYPE html>
<html>
    <head>
        <!--Bulma CSS framework-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.css"/>
        <!--Favicon-->
        <link rel="icon" href=../media/InvisibleMap.png>
        <meta charset="utf-12">
        <meta name="viewport" content="width=device-width">
        <title>Code Structure | Invisible Map Project Site</title>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </head>
    <body class="has-navbar-fixed-top">
        <!--Navigation bar (on all pages)-->
        <nav class="navbar is-light is-fixed-top" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <a class="navbar-item" href = "../index.html">
                    <img src=../media/InvisibleMapProjectLogo.png alt="Invisible Map Project Icon">
                </a>
                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" onclick="document.querySelector('.navbar-menu').classList.toggle('is-active');">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>                
            </div>
            <div class="navbar-menu">
                <div class="navbar-start">
                    <a class="navbar-item" href="../index.html">Home</a>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">The Concepts</a>
                        <div class="navbar-dropdown">
                            <a class = "navbar-item" href="../concepts/slam-intro.html">The Problem: SLAM</a>
                            <a class = navbar-item href="../concepts/graphs-intro.html">The Model: Graphs in the Invisible Map</a>
                            <a class = navbar-item href="../concepts/g2o-intro.html">The Solution: Introduction to G2O</a>
                            <a class = navbar-item href="../concepts/eval-intro.html">Map Evaluation</a>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">Overall Code</a>
                        <div class="navbar-dropdown">
                            <a class = "navbar-item" href="code-structure.html">Code Structure</a>
                            <a class = navbar-item href="data-structure.html">Data Structure</a>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">Component Details</a>
                        <div class="navbar-dropdown">
                            <a class = "navbar-item" href="../details/invisible-map-creator.html">Invisible Map Creator</a>
                            <a class = navbar-item href="../details/invisible-map-generation.html">Invisible Map Generation</a>
                            <a class = navbar-item href="../details/invisible-map.html">Invisible Map</a>
                        </div>
                    </div>                    
                </div>
            </div>
        </nav>

        <section class="hero is-small is-primary">
            <div class="hero-body">
                <h1 class="title is-2">Code Structure</h1>
            </div>
        </section>
        
        <section class="hero is-small is-success">
            <div class="hero-body">
                <h2 class="title is-3">On this page</h2>
                <div class="tabs is-toggle">
                    <ul class="is-size-5">
                        <li><a href="#map-creator">Invisible Map Creator</a></li>
                        <li><a href="#back-end">Map Processing (Optimization)</a></li>
                        <li><a href="#map-viewer">Invisible Map</a></li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="content">
                <p class="is-size-5">
                    This page contains a very broad look at the parts of the code for Invisible Map. For more detailed
                    descriptions of the ins and outs of the code, look at the pages linked under the Component Details
                    category on the <a href="../index.html">home page</a>. 
                </p>
                <p class="is-size-5">
                    Currently, the code consists of three main parts: the front-end map creation (Invisible Map Creator),
                    the back-end map processing, and the front-end map viewing (Invisible Map). The code for the front-end
                    parts are in the <a href="https://github.com/occamLab/InvisibleMap">InvisibleMap repository on
                    Github</a>, and the code for the back-end is in the
                    <a href="https://github.com/occamLab/invisible-map-generation">invisible-map-generation repository</a>.
                </p>
                <p class="is-size-5">
                    <b>An important usage note:</b> as of 6/17/2021, maps generated using the code in the master branches of
                    the invisible map repositories are not compatible with the code in the floor-detection and lidar-mesh
                    branches of the repositories and vice versa. The map data was restrucured, thus most maps uploaded to
                    Firebase after this date only work with the newest code.
                </p>
            </div>
        </section>
        
        <section class="section" id="map-creator">
            <div class="content">
                <h2>Invisible Map Creator</h2>
                <p class="is-size-5">
                    InvisibleMapCreator is an iOS app written in Swift and using
                    <a href="https://developer.apple.com/xcode/swiftui/" target="_blank">SwiftUI</a> and ARKit.
                    The most recent version of the map creator is in the InvisibleMapCreator2 folder of the lidar-mesh branch
                    of the InvisibleMap repository. The floor-detection branch of this repository also contains an updated
                    version of the structure of the data collected and includes gathering extra data about the planes
                    detected by ARKit. The most recent code is in the lidar-mesh branch, which contains new UI elements and
                    also uses planes detected by ARKit (especially on phones with LiDAR sensors) to more accurately position
                    tags.
                </p>
                <p class="is-size-5">
                    InvisibleMapCreator2 is a restructuring and redesign of the original
                    InvisibleMapCreator app. Marion and Avery describe the code structure in
                    <a href="https://docs.google.com/document/d/13iVLu6OGieQ8GTn1ysAw7daawXYnD5HghI6UZjw1c9s/edit?usp=sharing"
                    target="_blank">their write-up of their work</a> and also
                    link to more detailed resources to understand the architecture. In summary, the app utilizes a 
                    composable finite state machine, which tracks the different UIs (views) of the app. The state machine
                    responds to <b>events</b> which are usually triggered by some user input or action, and can 
                    <b>transition</b> between states or emit a <b>command</b> in response to an events. The commands are 
                    used to communicate with the main functional components of the app (such as gathering data points).
                    The map creator uploads the data to <a href="https://firebase.google.com/" target="_blank">
                    Firebase</a>, which hosts Invisible Map's data.
                </p>
                <p class="is-size-5">
                    The InvisibleMapCreator detects AprilTags as the user walks and also allows the user to save locations
                    at any points of interest they choose.
                </p>
            </div>
        </section>

        <section class="section" id="back-end">
            <div class="content">
                <h2>Map Processing (Optimization)</h2>
                <p class="is-size-5">
                    The back-end map processing code is written in Python and must be run from a Linux machine.
                    The most recent version of the processing code is in the floor-detection branch of the
                    invisible-map-generation repository. The README contains instructions on installing and running
                    the code and its dependencies. The back-end imports the raw map data from Firebase, runs it through
                    the G2O algorithm to optimize the map (phone positions and tag positions), and uploads the optimized map
                    to Firebase for the Invisible Map app to access.
                </p>
            </div>
        </section>

        <section class="section" id="map-viewer">
            <div class="content">
                <h2>Invisible Map</h2>
                <p class="is-size-5">
                    Invisible Map is an app written in Swift and C++ and using
                    <a href="https://developer.apple.com/documentation/uikit">UIKit</a> and ARKit.
                    The most recent version of the code is in the master branch of the InvisibleMap repository. This app
                    pulls the optimized map data from Firebase, and allows the user to pick a map and navigate around
                    a space. The app will show predicted locations of the AprilTags as well as any saved locations as the
                    user walks around.
                </p>
            </div>
        </section>
    </body>
</html>